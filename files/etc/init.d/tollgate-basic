#!/bin/sh /etc/rc.common

START=95
USE_PROCD=1

EXTRA_COMMANDS="status"
EXTRA_HELP="        status          Check service status"

start_service() {
    procd_open_instance
    procd_set_param command /usr/bin/tollgate-basic
    
    # Set working directory explicitly to /
    procd_set_param directory /
    
    # Ensure logs are saved
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param file /tmp/tollgate-debug.log
    
    # Set environment variables
    procd_set_param env TOLLGATE_DEBUG=1
    
    procd_close_instance
}

start() {
    echo "Starting TollGate basic" > /tmp/basic.log 2>&1
    tollgate-basic >> /tmp/basic.log 2>&1 &
    echo "PID: $!" >> /tmp/basic.log 2>&1
}

stop() {
    echo "Stopping TollGate basic"
    killall tollgate-basic
}

status() {
    if pgrep -f "tollgate-basic" >/dev/null; then
        echo "TollGate basic is running"
        return 0
    else
        echo "TollGate basic is not running"
        return 1
    fi
}
